{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/Lambda-CloudWatch1/",
    "result": {"data":{"cur":{"id":"5dad196f-3147-5f12-8cb1-82c531cee938","html":"<h2 id=\"-intro\" style=\"position:relative;\"><a href=\"#-intro\" aria-label=\" intro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💡 Intro</h2>\n<ul>\n<li>Lambda함수를 이용해 특정시간에 자동으로 카운트를 해야하는 방법이 필요해졌다!🙌</li>\n<li>AWS Lambda는 실시간으로 코드를 실행할 수는 있으나, 필요시에만 함수를 실행합니다. Lambda에 있는 함수를 자동으로 동작시킬 수 있는 기술을 찾던 중, 저는 Amazon CloudWatch에 있는 EventBridge를 알게되었습니다.</li>\n</ul>\n<h2 id=\"-들어가기전-알고가기--1\" style=\"position:relative;\"><a href=\"#-%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0%EC%A0%84-%EC%95%8C%EA%B3%A0%EA%B0%80%EA%B8%B0--1\" aria-label=\" 들어가기전 알고가기  1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔎 들어가기전, 알고가기! -1</h2>\n<p><strong>Lambda</strong></p>\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/welcome.html\">Lambda</a>는 서버를 프로비저닝하거나 관리하지 않고도 코드를 실행할 수 있게 해주는 컴퓨팅 서비스입니다. Lambda는 고가용성 컴퓨팅 인프라에서 코드를 실행하고 서버와 운영 체제 유지 관리, 용량 프로비저닝 및 자동 조정, 코드 및 보안 패치 배포, 코드 모니터링 및 로깅 등 모든 컴퓨팅 리소스 관리를 수행할 수 있습니다. 또한 Lambda는 필요시에만 함수를 실행하며, 일일 몇 개의 요청에서 초당 수천 개의 요청까지 자동으로 확장이 가능합니다. 그리고 사용한 컴퓨팅 시간만큼만 비용을 지불하고, 코드가 실행되지 않을 때는 요금이 부과되지 않습니다.</li>\n</ul>\n<p><strong>CloudWatch</strong></p>\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/ko_kr/AmazonCloudWatch/latest/monitoring/WhatIsCloudWatch.html\">CloudWatch</a>는 Amazon Web Services(AWS) 리소스 및 AWS에서 실행되는 애플리케이션을 실시간으로 모니터링합니다. CloudWatch를 사용하여 리소스 및 애플리케이션에 대해 측정할 수 있는 변수인 지표를 수집하고 추적할 수 있으며(<a href=\"https://docs.aws.amazon.com/ko_kr/AmazonCloudWatch/latest/logs/WhatIsCloudWatchLogs.html\">Amazon CloudWatch Logs</a>), <a href=\"https://docs.aws.amazon.com/ko_kr/eventbridge/latest/userguide/eb-what-is.html\">Amazon EventBridge</a>를 이용해 특정한 이벤트를 처리할 수 도 있습니다.</li>\n<li><a href=\"https://docs.aws.amazon.com/ko_kr/eventbridge/latest/userguide/eb-what-is.html\">EventBridge</a>는 과거에는  Amazon CloudWatch Events라고 불렸으며, Zendesk 또는 Shopify와 같은 이벤트 소스의 실시간 데이터 스트림을 AWS Lambda 및 기타 SaaS 애플리케이션과 같은 대상으로 전송하는 이벤트 기반 애플리케이션을 대규모로 손쉽게 구축할 수 있는 서버리스 이벤트 버스입니다.</li>\n</ul>\n<h2 id=\"-들어가기전-알고가기--2\" style=\"position:relative;\"><a href=\"#-%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0%EC%A0%84-%EC%95%8C%EA%B3%A0%EA%B0%80%EA%B8%B0--2\" aria-label=\" 들어가기전 알고가기  2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔎 들어가기전, 알고가기! -2</h2>\n<p><strong>크론(Cron) 표현식이란?🤔</strong></p>\n<ul>\n<li>EventBridge는 이벤트를 세팅할때 기본적으로 크론 정규표현식을 사용합니다. 그럼 크론식이 무엇일까요?(저도 이번에 크론식을 처음 경험해 보았는데, 쓸 경우가 종종 생길 것 같아서 정리해두려고 합니다.)</li>\n<li>유닉스 계열의 운영체제에서 시간 기반으로 job scheduling을 하는 프로세스를 <a href=\"https://docs.oracle.com/cd/E12058_01/doc/doc.1014/e12030/cron_expressions.htm\">크론 표현식(Cron Expressions)</a>라고 하며 자바 스프링의 Quartz나 Spring Scheduler에서도 사용하기도 한다고 합니다. 또한, 크론 표현식은 필드와 특수문자를 조합하여 스케쥴링을 조절할 수 있습니다.</li>\n<li>리눅스/유닉스 크론 표현식에서는 5개의 필드를 사용하고, Quartz 기반의 크론 표현식에서는 7개의 필드를 사용하는 String 문자열입니다. 공백으로 구분하고(” ”) 각 필드는 앞에서 부터 초, 분, 시, 일, 월, 요일, 년으로 구분합니다.</li>\n</ul>\n<p><strong>크론 표현식 표현</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 531px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB8klEQVQozz1TibKcIBD0/z8xyavs011PBFGQQ7RTPdFnlQVzwHTPNBUAaG1QN2+sm6OJGCPatkPX9fiuG8SUYZYFr+8Gfd+jbj7IR8EwDBLv+wF1/YbfA6pSCrRZYIzB5hyu60I+DlhroY2BtavYKSUYs0CpWXxHKfDey5nFWmybk8JVCAGTUoJgUhopZZRyCtLjOP6vpeC6IJcui8UFoNy+8zzlzJNX6WVF8+nQ9hPaYcLmA7Y9wu0Ry+pk3XyEDwnGbugGJba7c5hP/2NXhDmpGWrW0MYK7JgO5HxgDxEpH+Jjz7zfMWsjvudnzO3hZ18Rtl1XqHnGum431YJynogpyUqb1NgeUj7KKfSeWIgR53lJ0er31wvvbsQ4G3zaHt/vDtaFH8rbTYuUVxcwGYs9HeJffYC2G0Zl0EorAqo9BLTdgJkTnDViTAJfKocoVbPsk6iBOWaxCDFJTspZ5MLB8FxFxzCMkshL2QLKhJPm5Q+9fQ/SP/abuo23GpjLwqTPffXrz1+86jcmvci0v14NVv9M2d8TTRiURv3p8OlHUYORWMC8rBL7dKO0oGIzOZSuH+H8Ls0XhOcJ57zQIkpqkCzGSUHNRtAROXOphgdtxalS8XwVpMiPl/HF0GaB87pEyHwNVAJXxglGhJ2z2Dz3Dz+fnu+iWDR9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cron1.png\"\n        title=\"cron1.png\"\n        src=\"/static/db781eadd48f9b1a2eb3302ce4a351c5/d4713/cron1.png\"\n        srcset=\"/static/db781eadd48f9b1a2eb3302ce4a351c5/e9ff0/cron1.png 180w,\n/static/db781eadd48f9b1a2eb3302ce4a351c5/f21e7/cron1.png 360w,\n/static/db781eadd48f9b1a2eb3302ce4a351c5/d4713/cron1.png 531w\"\n        sizes=\"(max-width: 531px) 100vw, 531px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>\n<ul>\n<li>: 모든 값</li>\n</ul>\n</li>\n<li><strong>?</strong> : 특정한 값이 없음</li>\n<li><strong>-</strong> : 범위를 뜻 함 (예) 월요일에서 수요일까지는 MON-WED로 표현</li>\n<li><strong>,</strong> : 특별한 값일 때만 동작 (예) 월,수,금 MON,WED,FRI</li>\n<li><strong>/</strong> : 시작시간 / 단위  (예) 0분부터 매 5분 0/5</li>\n<li><strong>L</strong> : 일에서 사용하면 마지막 일, 요일에서는 마지막 요일(토요일)</li>\n<li><strong>W</strong> : 가장 가까운 평일 (예) 15W는 15일에서 가장 가까운 평일 (월 ~ 금)을 찾음</li>\n<li><strong>#</strong> : 몇째주의 무슨 요일을 표현 (예) 3#2 : 2번째주 수요일</li>\n</ul>\n<p><strong>크론 표현식 예제</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 718px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.88888888888889%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACFUlEQVQ4y21U2XKkMAz0///lbjLD5QsfGLChUy1m2GwqD10GqSW3DlCtHYgxoh9GWOdxnCdoO45fcJ7IecF5nr/6GafoTCnBOY+lFAmik/bvOI4TMSXMcxD89L8vUWXdYayH9QExFyxlu7DuP7BBW4+PR49RW5Rt/5WjamsIMWEOEWXdsNcmoF1QL9CmrcM4GcSYbnv9xiVHrXuFDxHWz8jLKjcT61Yv7BW1HZhjxqMboI2TXoe0YG+H+N9cxql13xFCkoRLWYWwvVGb2FJeYJxHP0wYtcGkjSRNaRE/lb1jFF/mmCSAvdvkxkthO044N+PR9VLqMGqMk8WzHyXpsxvgQ0I9zlul4g1UJ4NxV9mXyqu3VxIj6giWzHPS9j5jXoRPIYpBJDk/yy76OUqpojxEPJ+Xuq4fpFyC/MnY15A0Qsx32YrZqcz5IKSYlls+b+XAmKQbJlHb9aMkHCYjvjmkezAylL1WxJThfZAGc6JchXYc8nyekPd+vBIa6xBilJOqDvrb9ZVwdRSX0c0R2niRzgVNS7mQX1iKrMzHo0M/aqmEJ4cZ8/9cte07/Bxu8FaexlhY66F5OodhnGSyLL0bJ7G/bWwZuZyDymWVVeDajDKxgvJa6HVv8jn9/Xziz2eHz5dKrg25VMmKyCOfcaq1hpyyfE7rur3+GlcP+VxrhbFWFPOnoI0RJXzOOUvf/v1tGr4A0GuGC6eKrA4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cron2.png\"\n        title=\"cron2.png\"\n        src=\"/static/0ba4ce395992e48516cee93cbea77370/57dc1/cron2.png\"\n        srcset=\"/static/0ba4ce395992e48516cee93cbea77370/e9ff0/cron2.png 180w,\n/static/0ba4ce395992e48516cee93cbea77370/f21e7/cron2.png 360w,\n/static/0ba4ce395992e48516cee93cbea77370/57dc1/cron2.png 718w\"\n        sizes=\"(max-width: 718px) 100vw, 718px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>크론 표현식에 대해 공부를 하면서 느낀점은, 어느정도만 알면 전혀 어렵지 않다는 것입니다. 표를 보고 대충 이해하여 한번만 만들어봐도 다음 부터는 쉽게 만들 수 있습니다.😀</li>\n<li><a href=\"http://www.cronmaker.com/?1\">CronMaker</a>라는 원하는 크론 표현식을 생성해 주는 사이트 존재합니다. 대충 크론 표현식을 만든 후, 내가 만든 크론 표현식을 입력하고 Calcurate  next dates 버튼을 클릭하면, 내가 만든 크론 표현식으로 언제 실행될것인지 미리 볼수 있는 기능도 존재합니다.</li>\n</ul>\n<h2 id=\"-lambda-코드작성\" style=\"position:relative;\"><a href=\"#-lambda-%EC%BD%94%EB%93%9C%EC%9E%91%EC%84%B1\" aria-label=\" lambda 코드작성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 Lambda 코드작성</h2>\n<h3 id=\"1-lambda-함수생성\" style=\"position:relative;\"><a href=\"#1-lambda-%ED%95%A8%EC%88%98%EC%83%9D%EC%84%B1\" aria-label=\"1 lambda 함수생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Lambda 함수생성</h3>\n<p>아래와 같이 본인이 사용하는 언어를 선택한 후, Lambda 함수를 생성합니다. 그리고 VPC및 함수에 필요한 <a href=\"https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/configuration-layers.html\">Lambda Layer</a>를 설정합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABLElEQVQoz51S7W7DIAzkhfdC+z3tOfZn79GqUqe1ISEJGEM+brIbunSdpi5IJwwyx51ts9vv4ZxDSgkxxu1ghg8BprIWzIxxHDEMg0LiLRBSJex6D6KoP+RhwDzPGKcJ0x+QnJ8r5Qxzriq4tkWMjECkpCllfXBDspzlI1EjsSzJK+RKeLINgpAFuoAIRKQ1LWCpLzNyzlcSLER3hJWtESjqQZTlZRfwQlZIJUcUSlwU3lm2TYs0jCs737YU5W4V/9Y4ea+EbddfFYktqaXstBqHUl/mtBqvksc6JcWBkSb0fa/NmFdF/i+AWUnN6XyGdLr3XlVsQvCg4FWYORwOOB4/Llb4YoMfwE3eCDCAkCcYUdZ5j8Y5NG37MGR269ri03nU7y+wr0+o357xBY3ep8uvFmXOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Lambda.png\"\n        title=\"Lambda.png\"\n        src=\"/static/afeb3a803994ac1e65d0a7662d4770a0/37523/Lambda.png\"\n        srcset=\"/static/afeb3a803994ac1e65d0a7662d4770a0/e9ff0/Lambda.png 180w,\n/static/afeb3a803994ac1e65d0a7662d4770a0/f21e7/Lambda.png 360w,\n/static/afeb3a803994ac1e65d0a7662d4770a0/37523/Lambda.png 720w,\n/static/afeb3a803994ac1e65d0a7662d4770a0/b97f6/Lambda.png 958w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"2-lambda-코드작성\" style=\"position:relative;\"><a href=\"#2-lambda-%EC%BD%94%EB%93%9C%EC%9E%91%EC%84%B1\" aria-label=\"2 lambda 코드작성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Lambda 코드작성</h3>\n<p>자동으로 카운트 해주어야할 데이터를 조건에 따라서 가짓 수를 나누어 주었습니다. 저는 필요에 따라 S3와 RDS를 연결하였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">import</span> json\r\n<span class=\"token keyword\">import</span> base64<span class=\"token punctuation\">,</span> os<span class=\"token punctuation\">,</span> boto3<span class=\"token punctuation\">,</span> ast<span class=\"token punctuation\">,</span> copy\r\n<span class=\"token keyword\">import</span> json\r\n<span class=\"token keyword\">import</span> pymysql\r\n<span class=\"token keyword\">import</span> ast \r\n<span class=\"token keyword\">import</span> db_config\r\n\r\nAISCAN_URL <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\r\nrds_host <span class=\"token operator\">=</span> db_config<span class=\"token punctuation\">.</span>rds_host\r\nname <span class=\"token operator\">=</span> db_config<span class=\"token punctuation\">.</span>name\r\npassword <span class=\"token operator\">=</span> db_config<span class=\"token punctuation\">.</span>password\r\ndb_name <span class=\"token operator\">=</span> db_config<span class=\"token punctuation\">.</span>db_name \r\n<span class=\"token comment\">########### init s3 bucket info</span>\r\ns3 <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>resource<span class=\"token punctuation\">(</span><span class=\"token string\">'s3'</span><span class=\"token punctuation\">)</span> \r\nbucket_name <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">lambda_handler</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> \r\n    conn <span class=\"token operator\">=</span> pymysql<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span>rds_host<span class=\"token punctuation\">,</span> user<span class=\"token operator\">=</span>name<span class=\"token punctuation\">,</span> passwd<span class=\"token operator\">=</span>password<span class=\"token punctuation\">,</span> db<span class=\"token operator\">=</span>db_name<span class=\"token punctuation\">,</span> connect_timeout<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>    \r\n    c_query <span class=\"token operator\">=</span> <span class=\"token string\">''</span> \r\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\r\n    \r\n    <span class=\"token keyword\">with</span> conn<span class=\"token punctuation\">.</span>cursor<span class=\"token punctuation\">(</span>pymysql<span class=\"token punctuation\">.</span>cursors<span class=\"token punctuation\">.</span>DictCursor<span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> cur<span class=\"token punctuation\">:</span>\r\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>Amazon EventBridge 규칙 생성은 다음 포스팅에 이어서 작성을 해보도록 하겠습니다.😀</p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-intro\">💡 Intro</a></p>\n</li>\n<li>\n<p><a href=\"#-%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0%EC%A0%84-%EC%95%8C%EA%B3%A0%EA%B0%80%EA%B8%B0--1\">🔎 들어가기전, 알고가기! -1</a></p>\n</li>\n<li>\n<p><a href=\"#-%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0%EC%A0%84-%EC%95%8C%EA%B3%A0%EA%B0%80%EA%B8%B0--2\">🔎 들어가기전, 알고가기! -2</a></p>\n</li>\n<li>\n<p><a href=\"#-lambda-%EC%BD%94%EB%93%9C%EC%9E%91%EC%84%B1\">📚 Lambda 코드작성</a></p>\n<ul>\n<li><a href=\"#1-lambda-%ED%95%A8%EC%88%98%EC%83%9D%EC%84%B1\">1. Lambda 함수생성</a></li>\n<li><a href=\"#2-lambda-%EC%BD%94%EB%93%9C%EC%9E%91%EC%84%B1\">2. Lambda 코드작성</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"💡 Intro Lambda함수를 이용해 특정시간에 자동으로 카운트를 해야하는 방법이 필요해졌다!🙌 AWS Lambda는 실시간으로 코드를 실행할 수는 있으나, 필요시에만 함수를 실행합니다. Lambda에 있는 함수를 자동으로 동작시킬 수 있는 기술을 찾던 중, 저는 Amazon CloudWatch에 있는 EventBridge를 알게되었습니다. 🔎 들어가기전, 알고가기! -1 Lambda Lambda는 서버를 프로비저닝하거나 관리하지 않고도 코드를 실행할 수 있게 해주는 컴퓨팅 서비스입니다. Lambda는 고가용성 컴퓨팅 인프라에서 코드를 실행하고 서버와 운영 체제 유지 관리, 용량 프로비저닝 및 자동 조정, 코드 및 보안 패치 배포, 코드 모니터링 및 로깅 등 모든 컴퓨팅 리소스 관리를 수행할 수 있습니다. 또한 Lambda는 필요시에만 함수를 실행하며, 일일 몇 개의 요청에서 초당 수천 개의 요청까지 자동으로 확장이 가능합니다. 그리고 사용한 컴퓨팅 시간만큼만 비용을 지불하고, …","frontmatter":{"date":"April 04, 2022","title":"AWS CloudWatch로 특정시간 자동 카운트하기 -1","categories":"AWS 파이썬","author":"Liam","emoji":"💳"},"fields":{"slug":"/Lambda-CloudWatch1/"}},"next":{"id":"8f328073-7d55-56dd-9b01-a07fd8751fb2","html":"<h2 id=\"-intro\" style=\"position:relative;\"><a href=\"#-intro\" aria-label=\" intro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💡 Intro</h2>\n<ul>\n<li>원래 flask를 주로 사용하는데 지인분의 추천으로 FastAPI를 알게 되었습니다. FastAPI에서 libuv(node.js 성능의 핵심)를 코어로 사용하는 uvloop가 너무 매력적 이었고, <a href=\"https://asgi.readthedocs.io/en/latest/specs/main.html\">ASGI</a>를 한번 사용해보고싶어서 FastAPI를 한번 사용해볼까..? 라는 마음으로 사용해 보게 되었습니다.</li>\n<li>FastAPI로 관리자 웹을 만들다가 기존에 연결해 두었던 DB에 한개를 추가로 더 연결해서 MultipleDatabases를 구성해야하는 상황이 발생했습니다. 생각보다 reference가 많이 없었는데, FastAPI의 제작자이신 <a href=\"https://github.com/tiangolo/fastapi/issues/2592\">tiangolo</a>님의 issues에서 이 문제를 찾을 수 있었습니다. Multipledatabases에 대해 다양한분들의 의견이 잘 정리되어있어서 이를 저의 FastAPI에 적용한것을 정리해보려고 합니다.🙌</li>\n</ul>\n<h2 id=\"-그전에-fastapi란\" style=\"position:relative;\"><a href=\"#-%EA%B7%B8%EC%A0%84%EC%97%90-fastapi%EB%9E%80\" aria-label=\" 그전에 fastapi란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔎 그전에! FastAPI란?</h2>\n<p><a href=\"https://fastapi.tiangolo.com/\">공식 문서</a>에는 다음과 같이 설명되어져 있습니다.</p>\n<p>FastAPI is a modern, fast (high-performance), web framework for building APIs with Python 3.6+ based on standard Python type hints.</p>\n<p>주요기능:</p>\n<ul>\n<li>Fast: NodeJS 및 Go와 비슷한 성능, 현존하는 파이썬 웹 프레임워크 중 가장 빠르다.</li>\n<li>Fast to code</li>\n<li>Fewer bugs</li>\n<li>Intuitive</li>\n<li>Easy</li>\n<li>Short: 적은버그와 코드중복을 최소화할 수 있고, 각 매개변수 선언에 여러기능을 제공해준다.</li>\n<li>Robust: 문서 자동화 및 쉬운 배포가 가능하다.</li>\n<li>Standards-based: 개방형 API 표준(OpenAPI&#x26;JSON)을 기반으로 한다.</li>\n</ul>\n<p>이것만 아니라, 현재 아직 많은 레퍼런스가 나와있지는 않지만 그것을 매꿔줄 매우매우 수준높은 공식문서가 잘 마련되어져 있었습니다. 또한 백엔드 엔지니어 입장에서 API를 사용할 수 있도록 만든 문서 작업이 생각보다 많은 시간이 소요되는데, FastAPI는 문서의 자동화를 제공해줌으로써 개발자가 문서 작업에 할애하는 시간을 줄이고 오직 코드에만 집중할 수 있도록 해주어서 업무 효율을 증진 시켜줄 수 있습니다.</p>\n<h2 id=\"-multiple-databases-설정하기\" style=\"position:relative;\"><a href=\"#-multiple-databases-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\" multiple databases 설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 Multiple databases 설정하기</h2>\n<h3 id=\"1-settingspy\" style=\"position:relative;\"><a href=\"#1-settingspy\" aria-label=\"1 settingspy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. settings.py</h3>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">import</span> os\r\n<span class=\"token keyword\">from</span> functools <span class=\"token keyword\">import</span> lru_cache\r\n<span class=\"token keyword\">from</span> pydantic <span class=\"token keyword\">import</span> BaseSettings\r\n\r\n_VERSION_ <span class=\"token operator\">=</span> <span class=\"token string\">\"0.1.0\"</span>\r\n\r\n<span class=\"token comment\">###multiple databases-1</span>\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ISettings</span><span class=\"token punctuation\">(</span>BaseSettings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    db_engine<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"mysql+pymysql\"</span>\r\n    db_host<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n    db_user<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"root\"</span>\r\n    db_password<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n    db_port<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">3306</span>\r\n    db_database<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n\r\n    debug<span class=\"token punctuation\">:</span> <span class=\"token builtin\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\r\n\r\n    kakao_rest_key <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n\r\n    <span class=\"token decorator annotation punctuation\">@property</span>\r\n    <span class=\"token keyword\">def</span> <span class=\"token function\">db_dsn</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        dsn <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_engine<span class=\"token punctuation\">}</span></span><span class=\"token string\">://</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_user<span class=\"token punctuation\">}</span></span><span class=\"token string\">:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_password<span class=\"token punctuation\">}</span></span><span class=\"token string\">@</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_host<span class=\"token punctuation\">}</span></span><span class=\"token string\">:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_port<span class=\"token punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_database<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span>\r\n        <span class=\"token keyword\">return</span> dsn    \r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DevelopmentSettings</span><span class=\"token punctuation\">(</span>ISettings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">pass</span>\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductionSettings</span><span class=\"token punctuation\">(</span>ISettings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    debug <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span>\r\n\r\n\r\n<span class=\"token comment\">###multiple databases-2</span>\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ISettings2</span><span class=\"token punctuation\">(</span>BaseSettings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    db_engine<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"mysql+pymysql\"</span>\r\n    db_host<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n    db_user<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"admin\"</span>\r\n    db_password<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n    db_port<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">3306</span>\r\n    db_database<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n\r\n    debug<span class=\"token punctuation\">:</span> <span class=\"token builtin\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\r\n\r\n    kakao_rest_key <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n\r\n    <span class=\"token decorator annotation punctuation\">@property</span>\r\n    <span class=\"token keyword\">def</span> <span class=\"token function\">db_dsn</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        dsn <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_engine<span class=\"token punctuation\">}</span></span><span class=\"token string\">://</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_user<span class=\"token punctuation\">}</span></span><span class=\"token string\">:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_password<span class=\"token punctuation\">}</span></span><span class=\"token string\">@</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_host<span class=\"token punctuation\">}</span></span><span class=\"token string\">:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_port<span class=\"token punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_database<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span>\r\n        <span class=\"token keyword\">return</span> dsn    \r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DevelopmentSettings2</span><span class=\"token punctuation\">(</span>ISettings2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">pass</span>\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductionSettings2</span><span class=\"token punctuation\">(</span>ISettings2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    debug <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span>\r\n\r\n\r\n<span class=\"token decorator annotation punctuation\">@lru_cache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_settings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    config <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"FASTAPI_CONFIG\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">)</span>\r\n    configs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token string\">\"development\"</span><span class=\"token punctuation\">:</span> DevelopmentSettings<span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"production\"</span><span class=\"token punctuation\">:</span> ProductionSettings<span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">:</span> DevelopmentSettings<span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">return</span> configs<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> DevelopmentSettings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token decorator annotation punctuation\">@lru_cache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_settings2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    config <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"FASTAPI_CONFIG\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">)</span>\r\n    configs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token string\">\"development\"</span><span class=\"token punctuation\">:</span> DevelopmentSettings2<span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"production\"</span><span class=\"token punctuation\">:</span> ProductionSettings2<span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">:</span> DevelopmentSettings2<span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">return</span> configs<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> DevelopmentSettings2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>📌 functools - @lru_cache** : LRU(Least Recently Used)캐싱을 사용하기위해 <strong>@lru_cache</strong>를 사용했습니다. @lru_cache 데코레이터는 functools 내장 모듈로 부터 불러올 수 있으며, @lru_cache 를 아무 함수 위에 선언하면 사용하면 그 함수에 넘어온 인자를 키(key)로 함수의 호출 결과를 값(value)으로 LRU캐싱이 적용됩니다.</li>\n</ul>\n<h3 id=\"2-databasepy\" style=\"position:relative;\"><a href=\"#2-databasepy\" aria-label=\"2 databasepy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. database.py</h3>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\r\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\r\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> sessionmaker\r\n\r\n<span class=\"token keyword\">from</span> api<span class=\"token punctuation\">.</span>settings <span class=\"token keyword\">import</span> get_settings<span class=\"token punctuation\">,</span> get_settings2\r\n\r\nBase_1 <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\nBase_2 <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\nSQLALCHEMY_DATABASE_URL <span class=\"token operator\">=</span> get_settings<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>db_dsn\r\nSQLALCHEMY_DATABASE_URL2 <span class=\"token operator\">=</span> get_settings2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>db_dsn\r\n\r\n<span class=\"token comment\">###multiple databases-1</span>\r\nengine1 <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>SQLALCHEMY_DATABASE_URL<span class=\"token punctuation\">)</span>\r\nSessionLocal1 <span class=\"token operator\">=</span> sessionmaker<span class=\"token punctuation\">(</span>autocommit<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> autoflush<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> bind<span class=\"token operator\">=</span>engine1<span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token comment\">###multiple databases-2</span>\r\nengine2 <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>SQLALCHEMY_DATABASE_URL2<span class=\"token punctuation\">)</span>\r\nSessionLocal2 <span class=\"token operator\">=</span> sessionmaker<span class=\"token punctuation\">(</span>autocommit<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> autoflush<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> bind<span class=\"token operator\">=</span>engine2<span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_db</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    session <span class=\"token operator\">=</span> SessionLocal1<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">yield</span> session\r\n        session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\r\n        session<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n        \r\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_db2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    session <span class=\"token operator\">=</span> SessionLocal2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">yield</span> session\r\n        session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\r\n        session<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>📌 sqlalchemy : SQL 문법 없이 개발 중인 언어로 데이터베이스에 접근할 수 있게 해주는 라이브러리를 <strong>ORM(Object Relational Mapping)</strong> 이라고 합니다. 그 중에서도 <a href=\"https://www.sqlalchemy.org/\"><strong>sqlalchemy</strong></a>은 python의 대표적인 ORM입니다.</li>\n</ul>\n<h3 id=\"3-modelpy\" style=\"position:relative;\"><a href=\"#3-modelpy\" aria-label=\"3 modelpy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. model.py</h3>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">from</span> api<span class=\"token punctuation\">.</span>database <span class=\"token keyword\">import</span> Base_1<span class=\"token punctuation\">,</span> Base_2 \r\n<span class=\"token keyword\">from</span> api<span class=\"token punctuation\">.</span>models<span class=\"token punctuation\">.</span>base_model <span class=\"token keyword\">import</span> ModelBase\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DB_Schema1</span><span class=\"token punctuation\">(</span>Base_1<span class=\"token punctuation\">,</span> ModelBase<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">\"DB_Schema1_table\"</span>\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DB_Schema2</span><span class=\"token punctuation\">(</span>Base_2<span class=\"token punctuation\">,</span> ModelBase<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">\"DB_Schema2_table\"</span> </code></pre></div>\n<h3 id=\"4-routepy\" style=\"position:relative;\"><a href=\"#4-routepy\" aria-label=\"4 routepy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. route.py</h3>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">from</span> fastapi <span class=\"token keyword\">import</span> APIRouter<span class=\"token punctuation\">,</span> Depends<span class=\"token punctuation\">,</span> Body\r\n<span class=\"token keyword\">from</span> api<span class=\"token punctuation\">.</span>database <span class=\"token keyword\">import</span> get_db<span class=\"token punctuation\">,</span> get_db2\r\n\r\nrouter <span class=\"token operator\">=</span> APIRouter<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n\r\n<span class=\"token decorator annotation punctuation\">@router<span class=\"token punctuation\">.</span>get</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">\"/items/get_db1\"</span><span class=\"token punctuation\">,</span> description<span class=\"token operator\">=</span><span class=\"token string\">\"multiple DB\"</span>\r\n<span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">get_db1</span><span class=\"token punctuation\">(</span>\r\n    db<span class=\"token operator\">=</span>Depends<span class=\"token punctuation\">(</span>get_db<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    \r\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\r\n    \r\n    \r\n<span class=\"token decorator annotation punctuation\">@router<span class=\"token punctuation\">.</span>get</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">\"/items/get_db2\"</span><span class=\"token punctuation\">,</span> description<span class=\"token operator\">=</span><span class=\"token string\">\"multiple DB\"</span>\r\n<span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">get_db2</span><span class=\"token punctuation\">(</span>\r\n    db<span class=\"token operator\">=</span>Depends<span class=\"token punctuation\">(</span>get_db2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    \r\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span></code></pre></div>\n<p><strong>[참고자료]</strong></p>\n<ul>\n<li><a href=\"https://blog.neonkid.xyz/253\">https://blog.neonkid.xyz/253</a></li>\n<li><a href=\"https://pydantic-docs.helpmanual.io/usage/settings/\">pydantic - BaseSettings</a></li>\n<li><a href=\"https://fastapi.tiangolo.com/advanced/settings/\">FastAPI - pydantic BaseSettings예제</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-intro\">💡 Intro</a></p>\n</li>\n<li>\n<p><a href=\"#-%EA%B7%B8%EC%A0%84%EC%97%90-fastapi%EB%9E%80\">🔎 그전에! FastAPI란?</a></p>\n</li>\n<li>\n<p><a href=\"#-multiple-databases-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\">📚 Multiple databases 설정하기</a></p>\n<ul>\n<li><a href=\"#1-settingspy\">1. settings.py</a></li>\n<li><a href=\"#2-databasepy\">2. database.py</a></li>\n<li><a href=\"#3-modelpy\">3. model.py</a></li>\n<li><a href=\"#4-routepy\">4. route.py</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"March 30, 2022","title":"FastAPI에 2개 이상의 DB연동하기","categories":"AWS 파이썬 FastAPI","author":"Liam","emoji":"💽"},"fields":{"slug":"/FastAPI-Multipledatabases/"}},"prev":null,"site":{"siteMetadata":{"siteUrl":"https://liampoet.github.io","comments":{"utterances":{"repo":"liampoet/liampoet.github.io"}}}}},"pageContext":{"slug":"/Lambda-CloudWatch1/","nextSlug":"/FastAPI-Multipledatabases/","prevSlug":""}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}