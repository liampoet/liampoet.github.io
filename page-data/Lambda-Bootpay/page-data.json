{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/Lambda-Bootpay/",
    "result": {"data":{"cur":{"id":"a0f0a984-c811-5777-a190-b0efc223efad","html":"<h2 id=\"-intro\" style=\"position:relative;\"><a href=\"#-intro\" aria-label=\" intro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💡 Intro</h2>\n<p>BootPay는 무료로 서비스되는 결제검증API입니다. 초기에 일반 PG사와 별도의 계약없이 개발을 먼저 할 수 있어서, 앱결제가 급하게 필요했던 저는 <a href=\"https://docs.bootpay.co.kr\">BootPay</a>를 이용하기로 했습니다. 간단하게 사용방법을 정리해 보도록 하겠습니다.(매우간단해요!)🙌</p>\n<h2 id=\"-bootpay란\" style=\"position:relative;\"><a href=\"#-bootpay%EB%9E%80\" aria-label=\" bootpay란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔎 Bootpay란?</h2>\n<p>부트페이는 개발자를 위한 결제연동 서비스로, 구글 애널리틱스와 같이 결제 데이터 분석 서비스를 제공합니다. 또한 웹, 앱 SDK 모두 지원하며 국내외 여러 PG(복수 선택 가능)와 결제수단을 소스코드 한 줄로 사용할 수 있으므로 불필요한 작업을 줄일 수 있습니다.</p>\n<h2 id=\"-결제검증\" style=\"position:relative;\"><a href=\"#-%EA%B2%B0%EC%A0%9C%EA%B2%80%EC%A6%9D\" aria-label=\" 결제검증 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 결제검증</h2>\n<p>부트페이 측에서는 결제검증에 대해, 이렇게 설명하고 있습니다.</p>\n<p><strong>결제 검증을 해야하는 이유</strong></p>\n<ul>\n<li>결제 연동은 Client Side에서 동작되기 때문에 결제 금액 및 결제 상태에 대한 변조가 가능하다고 합니다. 그러므로 반드시 처음 요청했던 금액과 결제가 올바르게 이루어졌는지에 대해 서버사이드에서 서버로 영수증 키를 보내 확인하는 과정을 거쳐야 합니다.</li>\n</ul>\n<p><strong>그렇다면 결제 검증을 무조건 해야하나요?</strong></p>\n<ul>\n<li>결제 검증을 하지 않더라도 PG사에서 제공하는 결제 로직을 모두 완료할 수 있습니다. 방금 말했다시피, 실제 결제가 이루어지지만 Client Side에서 언제든 변조된 데이터를 구현하신 서버로 보내 부정적인 방법으로 구매 완료 데이터를 보낼 수 있기 때문에, 결제검증은 필수로 하는것이 좋다고 Bootpay에서는 설명하고 있습니다.</li>\n</ul>\n<h3 id=\"1-lambda-layer생성\" style=\"position:relative;\"><a href=\"#1-lambda-layer%EC%83%9D%EC%84%B1\" aria-label=\"1 lambda layer생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Lambda layer생성</h3>\n<p><a href=\"https://github.com/bootpay/server_python\">Bootpay 결제검증 및 취소 모듈(python)</a>을 다운 받은 뒤, 아래와 같이 Lambda layer를 생성합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABd0lEQVQoz6WTy1LjMBBF/d38B7/BH8yONTUFM4sZkgx5lkNs2Xo/bPWlWkmYAN4Ach23LEu3r1p2NZsvcP/wC6v1Br2UkEp9i4pv680GXdcjhADnPfwE7l1/ap6xFpWUCqvVGhyJMsZxfCWfuOznd+PMMAwlsmhljEHTthDawzhfXIYYiwPrA0JK8DGWd5bHQkLvB2ifEGMsYufGzxULtKLD42yOthWQShd4/O+zws/HJX7Pl1jsDtgJjVp56DDg32qLzXYHYyyc88VhEUwplSxNK2CdQ0zHzJkIcgCWe4GnE7V06AI7IqQUj7ULoax7FdTa4NA0qOs9nHPgBCwaQixbzgRk/GckAhFhqhVBrlW9f0YrRLHO2Ur9ODqHnPMHhnFEOtWOLhKwkcpaW2rHky4nnK8pwfPJvhGkjBgDKnbF2+RWFhC9gSZgwZSGj1smoNLGgFGn+Bn4k1PaQMke+s8t5OLu+Kd8FaUUGtHjUG/R31yh+3GNFzEDoUzm6WiJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Add_layer.png\"\n        title=\"Add_layer.png\"\n        src=\"/static/67ae63c41af404d5de8480453da5d1b3/37523/Add_layer.png\"\n        srcset=\"/static/67ae63c41af404d5de8480453da5d1b3/e9ff0/Add_layer.png 180w,\n/static/67ae63c41af404d5de8480453da5d1b3/f21e7/Add_layer.png 360w,\n/static/67ae63c41af404d5de8480453da5d1b3/37523/Add_layer.png 720w,\n/static/67ae63c41af404d5de8480453da5d1b3/302a4/Add_layer.png 1080w,\n/static/67ae63c41af404d5de8480453da5d1b3/07a9c/Add_layer.png 1440w,\n/static/67ae63c41af404d5de8480453da5d1b3/b1ffc/Add_layer.png 1492w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"2-add-a-layer\" style=\"position:relative;\"><a href=\"#2-add-a-layer\" aria-label=\"2 add a layer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Add a layer</h3>\n<p>생성한 Bootpay layer를 Lambda함수에 추가해 줍니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAABeElEQVQ4y6WUa1KEMBCEuaj38RIew0vo6l/1x2qpu8AKeRES3mlr4sK+sARMVRcpIF81PTMEq4dH3N2v8PT8gtwYSJVBZcsVfCUJojiGVArGWg81C0VngyiKsV6/wlqLpmlQ1/ViVVWFQGuNtm1Bq+u6xXLOeU5ANrfbEFrn/uYcSL/oXG8ooCCTNAXjfHjYTQE759/tRaslYJ7niOMdwjACFYjgVV1PcnsO9A5ZXoILhSRJfKi9u96pm6gBqG25dxh6aJqmJ/kcZwS4k3ujwKIowLnwbUNXLgQ45xBSIk2Zdz0G+BVIVRZS+S6XUvk9FYjt4VmmfdgHp+MuDxkyjo/PDajB3zchpKkuPndWhjRuNHbWFl7U8X+1C01UeRbFAOSmwNuOIZQGVbt/MKO6F0ClNYTKwIQEywya7ienxUBbFCjLElRtU1Ro2g5uxvwey8/yec9NXWPnyGfg/2XWLhJ93bDXEkamCKjC/xFNVsQz8NtrsJsrfAOn9cyFwbcovwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Lambda_layer.png\"\n        title=\"Lambda_layer.png\"\n        src=\"/static/5da65dd4ee83f09cacce616393e0da96/37523/Lambda_layer.png\"\n        srcset=\"/static/5da65dd4ee83f09cacce616393e0da96/e9ff0/Lambda_layer.png 180w,\n/static/5da65dd4ee83f09cacce616393e0da96/f21e7/Lambda_layer.png 360w,\n/static/5da65dd4ee83f09cacce616393e0da96/37523/Lambda_layer.png 720w,\n/static/5da65dd4ee83f09cacce616393e0da96/302a4/Lambda_layer.png 1080w,\n/static/5da65dd4ee83f09cacce616393e0da96/07a9c/Lambda_layer.png 1440w,\n/static/5da65dd4ee83f09cacce616393e0da96/f3abf/Lambda_layer.png 1474w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>그리고 import합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">from</span> lib<span class=\"token punctuation\">.</span>BootpayApi <span class=\"token keyword\">import</span> BootpayApi</code></pre></div>\n<h3 id=\"3-검증코드-작성하기\" style=\"position:relative;\"><a href=\"#3-%EA%B2%80%EC%A6%9D%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1%ED%95%98%EA%B8%B0\" aria-label=\"3 검증코드 작성하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 검증코드 작성하기</h3>\n<p>아래와 같이 검증코드만 작성하면 매우 간단하게 결제 검증을 끝낼 수 있습니다.😀 저는 웹결제가 없었기 떄문에 앱에서 결제 후 서버사이드에서 결제 검증만 진행하였으며, application_id와 private_key는 Bootpay 관리자에서 확인할 수 있습니다. 또한 아래 코드와 같이 결제 금액으로 비교를 해주면 되는데, 가격말고도 원하는 다른 데이터를 추가로 비교할 수 도있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">from</span> lib<span class=\"token punctuation\">.</span>BootpayApi <span class=\"token keyword\">import</span> BootpayApi\r\n\r\nbootpay <span class=\"token operator\">=</span> BootpayApi<span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">'[[ application_id ]]'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'[[ private_key ]]'</span>\r\n<span class=\"token punctuation\">)</span>\r\n\r\nresult <span class=\"token operator\">=</span> bootpay<span class=\"token punctuation\">.</span>get_access_token<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">if</span> result<span class=\"token punctuation\">[</span><span class=\"token string\">'status'</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">is</span> <span class=\"token number\">200</span><span class=\"token punctuation\">:</span>\r\n    verify_result <span class=\"token operator\">=</span> bootpay<span class=\"token punctuation\">.</span>verify<span class=\"token punctuation\">(</span><span class=\"token string\">'[[ receipt_id ]]'</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">if</span> verify_result<span class=\"token punctuation\">[</span><span class=\"token string\">'status'</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">is</span> <span class=\"token number\">200</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token comment\"># 원래 주문했던 금액이 일치하는가?</span>\r\n        <span class=\"token comment\"># 그리고 결제 상태가 완료 상태인가?</span>\r\n        <span class=\"token keyword\">if</span> verify_result<span class=\"token punctuation\">[</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'status'</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">is</span> <span class=\"token number\">1</span> <span class=\"token keyword\">and</span> verify_result<span class=\"token punctuation\">[</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'price'</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">is</span> price<span class=\"token punctuation\">:</span>\r\n            <span class=\"token comment\"># TODO: 이곳이 상품 지급 혹은 결제 완료 처리를 하는 로직으로 사용하면 됩니다.</span></code></pre></div>\n<h2 id=\"-검증결과\" style=\"position:relative;\"><a href=\"#-%EA%B2%80%EC%A6%9D%EA%B2%B0%EA%B3%BC\" aria-label=\" 검증결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧩 검증결과</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\r\n  <span class=\"token string\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token string\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token string\">\"message\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token string\">\"data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token string\">\"receipt_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"order_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"12345678910\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"테스트음식\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"unit\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"krw\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"pg\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"kcp\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"method\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"card\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"pg_name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"KCP\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"method_name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"카드결제\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"payment_data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token string\">\"card_name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"BC카드\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"card_no\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"card_quota\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"00\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"card_auth_no\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"receipt_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"n\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"테스트음식\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"p\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"pg\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"KCP\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"pm\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"카드결제\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"pg_a\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"kcp\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"pm_a\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"card\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"o_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"p_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-12-27\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"s\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"g\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"requested_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-12-27 16:47:52\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"purchased_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-12-27 16:48:53\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>결제가 완료되면 “s”값이 1이 나옵니다. “status”의 경우 현재 결제의 상태를 보여주는데, 다음과 같이 나타낼 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">gist4\r\n결제 <span class=\"token function\">상태</span> <span class=\"token punctuation\">(</span> 현재 결제의 상태를 나타냅니다<span class=\"token punctuation\">.</span> 결제 검증에서 가장 중요한 지표가 됩니다<span class=\"token punctuation\">.</span> <span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token number\">0</span> <span class=\"token operator\">-</span> 결제 대기 상태입니다<span class=\"token punctuation\">.</span> 승인이 나기 전의 상태입니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token number\">1</span> <span class=\"token operator\">-</span> 결제 완료된 상태입니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token number\">2</span> <span class=\"token operator\">-</span> 결제승인 전 상태입니다<span class=\"token punctuation\">.</span> <span class=\"token function\">transactionConfirm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> 함수를 호출하셔서 결제를 승인해야합니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token number\">3</span> <span class=\"token operator\">-</span> 결제승인 중 상태입니다<span class=\"token punctuation\">.</span> <span class=\"token constant\">PG</span>사에서 transaction 처리중입니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token number\">20</span> <span class=\"token operator\">-</span> 결제가 취소된 상태입니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token operator\">-</span><span class=\"token number\">20</span> <span class=\"token operator\">-</span> 결제취소가 실패한 상태입니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token operator\">-</span><span class=\"token number\">30</span> <span class=\"token operator\">-</span> 결제취소가 진행중인 상태입니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> 오류로 인해 결제가 실패한 상태입니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token operator\">-</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> 결제승인이 실패하였습니다<span class=\"token punctuation\">.</span></code></pre></div>\n<p>서류작성 및 PG사 심사(앱 결제테스트 등)는 거의 3주 가까이 걸렸는데, 서버사이드의 작업은 3시간도 채 걸리지 않고 작업을 끝낼 수 있었습니다.\r\n또한 Bootpay 개발자와 원할한 소통도 가능하고 Bootpay 버그에 대한 수정 요청도 빠르게 처리해 주기 때문에,(우리는 앱단에서 요청사항이 있었는데, 4일내로 업데이트 해주셨음…)\r\n저 처럼 빠른시일내 앱결제 시스템이 필요한경우가 있으신분은 Bootpay를 한번 고려해보는것도 좋은 선택인것 같습니다!😛</p>\n<p><strong>[참고자료]</strong></p>\n<ul>\n<li><a href=\"https://docs.bootpay.co.kr/rest/verify\">https://docs.bootpay.co.kr/rest/verify</a></li>\n<li><a href=\"https://medium.com/@bootpay.co.kr/%ED%8E%98%EC%9D%B4%EC%95%B1-api%EB%A1%9C-%EC%97%B0%EB%8F%99%ED%95%98%EA%B8%B0-%EA%B2%B0%EC%A0%9C-%EA%B2%80%EC%A6%9D-2-3-4659bd100f86\">페이앱-api로-연동하기-결제-검증</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-intro\">💡 Intro</a></p>\n</li>\n<li>\n<p><a href=\"#-bootpay%EB%9E%80\">🔎 Bootpay란?</a></p>\n</li>\n<li>\n<p><a href=\"#-%EA%B2%B0%EC%A0%9C%EA%B2%80%EC%A6%9D\">📚 결제검증</a></p>\n<ul>\n<li><a href=\"#1-lambda-layer%EC%83%9D%EC%84%B1\">1. Lambda layer생성</a></li>\n<li><a href=\"#2-add-a-layer\">2. Add a layer</a></li>\n<li><a href=\"#3-%EA%B2%80%EC%A6%9D%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1%ED%95%98%EA%B8%B0\">3. 검증코드 작성하기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EA%B2%80%EC%A6%9D%EA%B2%B0%EA%B3%BC\">🧩 검증결과</a></p>\n</li>\n</ul>\n</div>","excerpt":"💡 Intro BootPay는 무료로 서비스되는 결제검증API입니다. 초기에 일반 PG사와 별도의 계약없이 개발을 먼저 할 수 있어서, 앱결제가 급하게 필요했던 저는 BootPay를 이용하기로 했습니다. 간단하게 사용방법을 정리해 보도록 하겠습니다.(매우간단해요!)🙌 🔎 Bootpay란? 부트페이는 개발자를 위한 결제연동 서비스로, 구글 애널리틱스와 같이 결제 데이터 분석 서비스를 제공합니다. 또한 웹, 앱 SDK 모두 지원하며 국내외 여러 PG(복수 선택 가능)와 결제수단을 소스코드 한 줄로 사용할 수 있으므로 불필요한 작업을 줄일 수 있습니다. 📚 결제검증 부트페이 측에서는 결제검증에 대해, 이렇게 설명하고 있습니다. 결제 검증을 해야하는 이유 결제 연동은 Client Side에서 동작되기 때문에 결제 금액 및 결제 상태에 대한 변조가 가능하다고 합니다. 그러므로 반드시 처음 요청했던 금액과 결제가 올바르게 이루어졌는지에 대해 서버사이드에서 서버로 영수증 키를 보내 확인하는 과…","frontmatter":{"date":"March 15, 2022","title":"AWS Lambda에 Bootpay연동하기 - 결제검증","categories":"AWS 파이썬 부트페이","author":"Liam","emoji":"💳"},"fields":{"slug":"/Lambda-Bootpay/"}},"next":{"id":"6a322e66-8ca4-520f-ba3a-99cdba5a4808","html":"<h2 id=\"-intro\" style=\"position:relative;\"><a href=\"#-intro\" aria-label=\" intro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💡 Intro</h2>\n<p>BootPay는 무료로 서비스되는 결제검증API입니다. 초기에 일반 PG사와 별도의 계약없이 개발을 먼저 할 수 있어서, 앱결제가 급하게 필요했던 저는 <a href=\"https://docs.bootpay.co.kr\">BootPay</a>를 이용하기로 했습니다. 간단하게 사용방법을 정리해 보도록 하겠습니다.(매우간단해요!)🙌</p>\n<h2 id=\"-bootpay란\" style=\"position:relative;\"><a href=\"#-bootpay%EB%9E%80\" aria-label=\" bootpay란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔎 Bootpay란?</h2>\n<p>부트페이는 개발자를 위한 결제연동 서비스로, 구글 애널리틱스와 같이 결제 데이터 분석 서비스를 제공합니다. 또한 웹, 앱 SDK 모두 지원하며 국내외 여러 PG(복수 선택 가능)와 결제수단을 소스코드 한 줄로 사용할 수 있으므로 불필요한 작업을 줄일 수 있습니다.</p>\n<h2 id=\"-결제검증\" style=\"position:relative;\"><a href=\"#-%EA%B2%B0%EC%A0%9C%EA%B2%80%EC%A6%9D\" aria-label=\" 결제검증 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 결제검증</h2>\n<p>부트페이 측에서는 결제검증에 대해, 이렇게 설명하고 있습니다.</p>\n<p><strong>결제 검증을 해야하는 이유</strong></p>\n<ul>\n<li>결제 연동은 Client Side에서 동작되기 때문에 결제 금액 및 결제 상태에 대한 변조가 가능하다고 합니다. 그러므로 반드시 처음 요청했던 금액과 결제가 올바르게 이루어졌는지에 대해 서버사이드에서 서버로 영수증 키를 보내 확인하는 과정을 거쳐야 합니다.</li>\n</ul>\n<p><strong>그렇다면 결제 검증을 무조건 해야하나요?</strong></p>\n<ul>\n<li>결제 검증을 하지 않더라도 PG사에서 제공하는 결제 로직을 모두 완료할 수 있습니다. 방금 말했다시피, 실제 결제가 이루어지지만 Client Side에서 언제든 변조된 데이터를 구현하신 서버로 보내 부정적인 방법으로 구매 완료 데이터를 보낼 수 있기 때문에, 결제검증은 필수로 하는것이 좋다고 Bootpay에서는 설명하고 있습니다.</li>\n</ul>\n<h3 id=\"1-lambda-layer생성\" style=\"position:relative;\"><a href=\"#1-lambda-layer%EC%83%9D%EC%84%B1\" aria-label=\"1 lambda layer생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Lambda layer생성</h3>\n<p><a href=\"https://github.com/bootpay/server_python\">Bootpay 결제검증 및 취소 모듈(python)</a>을 다운 받은 뒤, 아래와 같이 Lambda layer를 생성합니다.</p>\n<p><img src=\"Add_layer.png\" alt=\"Add_layer.png\"></p>\n<h3 id=\"2-add-a-layer\" style=\"position:relative;\"><a href=\"#2-add-a-layer\" aria-label=\"2 add a layer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Add a layer</h3>\n<p>생성한 Bootpay layer를 Lambda함수에 추가해 줍니다.</p>\n<p><img src=\"Lambda_layer.png\" alt=\"Lambda_layer.png\"></p>\n<p>그리고 import합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">from</span> lib<span class=\"token punctuation\">.</span>BootpayApi <span class=\"token keyword\">import</span> BootpayApi</code></pre></div>\n<h3 id=\"3-검증코드-작성하기\" style=\"position:relative;\"><a href=\"#3-%EA%B2%80%EC%A6%9D%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1%ED%95%98%EA%B8%B0\" aria-label=\"3 검증코드 작성하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 검증코드 작성하기</h3>\n<p>아래와 같이 검증코드만 작성하면 매우 간단하게 결제 검증을 끝낼 수 있습니다.😀 저는 웹결제가 없었기 떄문에 앱에서 결제 후 서버사이드에서 결제 검증만 진행하였으며, application_id와 private_key는 Bootpay 관리자에서 확인할 수 있습니다. 또한 아래 코드와 같이 결제 금액으로 비교를 해주면 되는데, 가격말고도 원하는 다른 데이터를 추가로 비교할 수 도있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">from</span> lib<span class=\"token punctuation\">.</span>BootpayApi <span class=\"token keyword\">import</span> BootpayApi\r\n\r\nbootpay <span class=\"token operator\">=</span> BootpayApi<span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">'[[ application_id ]]'</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">'[[ private_key ]]'</span>\r\n<span class=\"token punctuation\">)</span>\r\n\r\nresult <span class=\"token operator\">=</span> bootpay<span class=\"token punctuation\">.</span>get_access_token<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">if</span> result<span class=\"token punctuation\">[</span><span class=\"token string\">'status'</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">is</span> <span class=\"token number\">200</span><span class=\"token punctuation\">:</span>\r\n    verify_result <span class=\"token operator\">=</span> bootpay<span class=\"token punctuation\">.</span>verify<span class=\"token punctuation\">(</span><span class=\"token string\">'[[ receipt_id ]]'</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">if</span> verify_result<span class=\"token punctuation\">[</span><span class=\"token string\">'status'</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">is</span> <span class=\"token number\">200</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token comment\"># 원래 주문했던 금액이 일치하는가?</span>\r\n        <span class=\"token comment\"># 그리고 결제 상태가 완료 상태인가?</span>\r\n        <span class=\"token keyword\">if</span> verify_result<span class=\"token punctuation\">[</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'status'</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">is</span> <span class=\"token number\">1</span> <span class=\"token keyword\">and</span> verify_result<span class=\"token punctuation\">[</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'price'</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">is</span> price<span class=\"token punctuation\">:</span>\r\n            <span class=\"token comment\"># TODO: 이곳이 상품 지급 혹은 결제 완료 처리를 하는 로직으로 사용하면 됩니다.</span></code></pre></div>\n<h2 id=\"-검증결과\" style=\"position:relative;\"><a href=\"#-%EA%B2%80%EC%A6%9D%EA%B2%B0%EA%B3%BC\" aria-label=\" 검증결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🧩 검증결과</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token punctuation\">{</span>\r\n  <span class=\"token string\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token string\">\"code\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token string\">\"message\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token string\">\"data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token string\">\"receipt_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"order_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"12345678910\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"테스트음식\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"unit\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"krw\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"pg\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"kcp\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"method\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"card\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"pg_name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"KCP\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"method_name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"카드결제\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"payment_data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token string\">\"card_name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"BC카드\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"card_no\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"card_quota\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"00\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"card_auth_no\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"receipt_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"n\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"테스트음식\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"p\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"pg\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"KCP\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"pm\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"카드결제\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"pg_a\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"kcp\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"pm_a\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"card\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"o_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"p_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-12-27\"</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"s\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\r\n      <span class=\"token string\">\"g\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"requested_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-12-27 16:47:52\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"purchased_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2021-12-27 16:48:53\"</span><span class=\"token punctuation\">,</span>\r\n    <span class=\"token string\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>결제가 완료되면 “s”값이 1이 나옵니다. “status”의 경우 현재 결제의 상태를 보여주는데, 다음과 같이 나타낼 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">gist4\r\n결제 <span class=\"token function\">상태</span> <span class=\"token punctuation\">(</span> 현재 결제의 상태를 나타냅니다<span class=\"token punctuation\">.</span> 결제 검증에서 가장 중요한 지표가 됩니다<span class=\"token punctuation\">.</span> <span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token number\">0</span> <span class=\"token operator\">-</span> 결제 대기 상태입니다<span class=\"token punctuation\">.</span> 승인이 나기 전의 상태입니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token number\">1</span> <span class=\"token operator\">-</span> 결제 완료된 상태입니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token number\">2</span> <span class=\"token operator\">-</span> 결제승인 전 상태입니다<span class=\"token punctuation\">.</span> <span class=\"token function\">transactionConfirm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> 함수를 호출하셔서 결제를 승인해야합니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token number\">3</span> <span class=\"token operator\">-</span> 결제승인 중 상태입니다<span class=\"token punctuation\">.</span> <span class=\"token constant\">PG</span>사에서 transaction 처리중입니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token number\">20</span> <span class=\"token operator\">-</span> 결제가 취소된 상태입니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token operator\">-</span><span class=\"token number\">20</span> <span class=\"token operator\">-</span> 결제취소가 실패한 상태입니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token operator\">-</span><span class=\"token number\">30</span> <span class=\"token operator\">-</span> 결제취소가 진행중인 상태입니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> 오류로 인해 결제가 실패한 상태입니다<span class=\"token punctuation\">.</span>\r\n<span class=\"token operator\">-</span><span class=\"token number\">2</span> <span class=\"token operator\">-</span> 결제승인이 실패하였습니다<span class=\"token punctuation\">.</span></code></pre></div>\n<p>서류작성 및 PG사 심사(앱 결제테스트 등)는 거의 3주 가까이 걸렸는데, 서버사이드의 작업은 3시간도 채 걸리지 않고 작업을 끝낼 수 있었습니다.\r\n또한 Bootpay 개발자와 원할한 소통도 가능하고 Bootpay 버그에 대한 수정 요청도 빠르게 처리해 주기 때문에,(우리는 앱단에서 요청사항이 있었는데, 4일내로 업데이트 해주셨음…)\r\n저 처럼 빠른시일내 앱결제 시스템이 필요한경우가 있으신분은 Bootpay를 한번 고려해보는것도 좋은 선택인것 같습니다!😛</p>\n<p><strong>[참고자료]</strong></p>\n<ul>\n<li><a href=\"https://docs.bootpay.co.kr/rest/verify\">https://docs.bootpay.co.kr/rest/verify</a></li>\n<li><a href=\"https://medium.com/@bootpay.co.kr/%ED%8E%98%EC%9D%B4%EC%95%B1-api%EB%A1%9C-%EC%97%B0%EB%8F%99%ED%95%98%EA%B8%B0-%EA%B2%B0%EC%A0%9C-%EA%B2%80%EC%A6%9D-2-3-4659bd100f86\">페이앱-api로-연동하기-결제-검증</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-intro\">💡 Intro</a></p>\n</li>\n<li>\n<p><a href=\"#-bootpay%EB%9E%80\">🔎 Bootpay란?</a></p>\n</li>\n<li>\n<p><a href=\"#-%EA%B2%B0%EC%A0%9C%EA%B2%80%EC%A6%9D\">📚 결제검증</a></p>\n<ul>\n<li><a href=\"#1-lambda-layer%EC%83%9D%EC%84%B1\">1. Lambda layer생성</a></li>\n<li><a href=\"#2-add-a-layer\">2. Add a layer</a></li>\n<li><a href=\"#3-%EA%B2%80%EC%A6%9D%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1%ED%95%98%EA%B8%B0\">3. 검증코드 작성하기</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#-%EA%B2%80%EC%A6%9D%EA%B2%B0%EA%B3%BC\">🧩 검증결과</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"March 15, 2022","title":"AWS Lambda에 Bootpay연동하기 - 결제검증","categories":"AWS 파이썬 부트페이","author":"Liam","emoji":"💳"},"fields":{"slug":"/Lambda-CloudWatch2/"}},"prev":{"id":"8f328073-7d55-56dd-9b01-a07fd8751fb2","html":"<h2 id=\"-intro\" style=\"position:relative;\"><a href=\"#-intro\" aria-label=\" intro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>💡 Intro</h2>\n<ul>\n<li>원래 flask를 주로 사용하는데 지인분의 추천으로 FastAPI를 알게 되었습니다. FastAPI에서 libuv(node.js 성능의 핵심)를 코어로 사용하는 uvloop가 너무 매력적 이었고, <a href=\"https://asgi.readthedocs.io/en/latest/specs/main.html\">ASGI</a>를 한번 사용해보고싶어서 FastAPI를 한번 사용해볼까..? 라는 마음으로 사용해 보게 되었습니다.</li>\n<li>FastAPI로 관리자 웹을 만들다가 기존에 연결해 두었던 DB에 한개를 추가로 더 연결해서 MultipleDatabases를 구성해야하는 상황이 발생했습니다. 생각보다 reference가 많이 없었는데, FastAPI의 제작자이신 <a href=\"https://github.com/tiangolo/fastapi/issues/2592\">tiangolo</a>님의 issues에서 이 문제를 찾을 수 있었습니다. Multipledatabases에 대해 다양한분들의 의견이 잘 정리되어있어서 이를 저의 FastAPI에 적용한것을 정리해보려고 합니다.🙌</li>\n</ul>\n<h2 id=\"-그전에-fastapi란\" style=\"position:relative;\"><a href=\"#-%EA%B7%B8%EC%A0%84%EC%97%90-fastapi%EB%9E%80\" aria-label=\" 그전에 fastapi란 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🔎 그전에! FastAPI란?</h2>\n<p><a href=\"https://fastapi.tiangolo.com/\">공식 문서</a>에는 다음과 같이 설명되어져 있습니다.</p>\n<p>FastAPI is a modern, fast (high-performance), web framework for building APIs with Python 3.6+ based on standard Python type hints.</p>\n<p>주요기능:</p>\n<ul>\n<li>Fast: NodeJS 및 Go와 비슷한 성능, 현존하는 파이썬 웹 프레임워크 중 가장 빠르다.</li>\n<li>Fast to code</li>\n<li>Fewer bugs</li>\n<li>Intuitive</li>\n<li>Easy</li>\n<li>Short: 적은버그와 코드중복을 최소화할 수 있고, 각 매개변수 선언에 여러기능을 제공해준다.</li>\n<li>Robust: 문서 자동화 및 쉬운 배포가 가능하다.</li>\n<li>Standards-based: 개방형 API 표준(OpenAPI&#x26;JSON)을 기반으로 한다.</li>\n</ul>\n<p>이것만 아니라, 현재 아직 많은 레퍼런스가 나와있지는 않지만 그것을 매꿔줄 매우매우 수준높은 공식문서가 잘 마련되어져 있었습니다. 또한 백엔드 엔지니어 입장에서 API를 사용할 수 있도록 만든 문서 작업이 생각보다 많은 시간이 소요되는데, FastAPI는 문서의 자동화를 제공해줌으로써 개발자가 문서 작업에 할애하는 시간을 줄이고 오직 코드에만 집중할 수 있도록 해주어서 업무 효율을 증진 시켜줄 수 있습니다.</p>\n<h2 id=\"-multiple-databases-설정하기\" style=\"position:relative;\"><a href=\"#-multiple-databases-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\" multiple databases 설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>📚 Multiple databases 설정하기</h2>\n<h3 id=\"1-settingspy\" style=\"position:relative;\"><a href=\"#1-settingspy\" aria-label=\"1 settingspy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. settings.py</h3>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">import</span> os\r\n<span class=\"token keyword\">from</span> functools <span class=\"token keyword\">import</span> lru_cache\r\n<span class=\"token keyword\">from</span> pydantic <span class=\"token keyword\">import</span> BaseSettings\r\n\r\n_VERSION_ <span class=\"token operator\">=</span> <span class=\"token string\">\"0.1.0\"</span>\r\n\r\n<span class=\"token comment\">###multiple databases-1</span>\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ISettings</span><span class=\"token punctuation\">(</span>BaseSettings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    db_engine<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"mysql+pymysql\"</span>\r\n    db_host<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n    db_user<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"root\"</span>\r\n    db_password<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n    db_port<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">3306</span>\r\n    db_database<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n\r\n    debug<span class=\"token punctuation\">:</span> <span class=\"token builtin\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\r\n\r\n    kakao_rest_key <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n\r\n    <span class=\"token decorator annotation punctuation\">@property</span>\r\n    <span class=\"token keyword\">def</span> <span class=\"token function\">db_dsn</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        dsn <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_engine<span class=\"token punctuation\">}</span></span><span class=\"token string\">://</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_user<span class=\"token punctuation\">}</span></span><span class=\"token string\">:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_password<span class=\"token punctuation\">}</span></span><span class=\"token string\">@</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_host<span class=\"token punctuation\">}</span></span><span class=\"token string\">:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_port<span class=\"token punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_database<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span>\r\n        <span class=\"token keyword\">return</span> dsn    \r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DevelopmentSettings</span><span class=\"token punctuation\">(</span>ISettings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">pass</span>\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductionSettings</span><span class=\"token punctuation\">(</span>ISettings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    debug <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span>\r\n\r\n\r\n<span class=\"token comment\">###multiple databases-2</span>\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ISettings2</span><span class=\"token punctuation\">(</span>BaseSettings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    db_engine<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"mysql+pymysql\"</span>\r\n    db_host<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n    db_user<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"admin\"</span>\r\n    db_password<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n    db_port<span class=\"token punctuation\">:</span> <span class=\"token builtin\">int</span> <span class=\"token operator\">=</span> <span class=\"token number\">3306</span>\r\n    db_database<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n\r\n    debug<span class=\"token punctuation\">:</span> <span class=\"token builtin\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span>\r\n\r\n    kakao_rest_key <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\r\n\r\n    <span class=\"token decorator annotation punctuation\">@property</span>\r\n    <span class=\"token keyword\">def</span> <span class=\"token function\">db_dsn</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        dsn <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_engine<span class=\"token punctuation\">}</span></span><span class=\"token string\">://</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_user<span class=\"token punctuation\">}</span></span><span class=\"token string\">:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_password<span class=\"token punctuation\">}</span></span><span class=\"token string\">@</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_host<span class=\"token punctuation\">}</span></span><span class=\"token string\">:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_port<span class=\"token punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>self<span class=\"token punctuation\">.</span>db_database<span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span>\r\n        <span class=\"token keyword\">return</span> dsn    \r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DevelopmentSettings2</span><span class=\"token punctuation\">(</span>ISettings2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">pass</span>\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductionSettings2</span><span class=\"token punctuation\">(</span>ISettings2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    debug <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span>\r\n\r\n\r\n<span class=\"token decorator annotation punctuation\">@lru_cache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_settings</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    config <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"FASTAPI_CONFIG\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">)</span>\r\n    configs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token string\">\"development\"</span><span class=\"token punctuation\">:</span> DevelopmentSettings<span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"production\"</span><span class=\"token punctuation\">:</span> ProductionSettings<span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">:</span> DevelopmentSettings<span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">return</span> configs<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> DevelopmentSettings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token decorator annotation punctuation\">@lru_cache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_settings2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    config <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"FASTAPI_CONFIG\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">)</span>\r\n    configs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token string\">\"development\"</span><span class=\"token punctuation\">:</span> DevelopmentSettings2<span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"production\"</span><span class=\"token punctuation\">:</span> ProductionSettings2<span class=\"token punctuation\">,</span>\r\n        <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">:</span> DevelopmentSettings2<span class=\"token punctuation\">,</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">return</span> configs<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> DevelopmentSettings2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>📌 functools - @lru_cache** : LRU(Least Recently Used)캐싱을 사용하기위해 <strong>@lru_cache</strong>를 사용했습니다. @lru_cache 데코레이터는 functools 내장 모듈로 부터 불러올 수 있으며, @lru_cache 를 아무 함수 위에 선언하면 사용하면 그 함수에 넘어온 인자를 키(key)로 함수의 호출 결과를 값(value)으로 LRU캐싱이 적용됩니다.</li>\n</ul>\n<h3 id=\"2-databasepy\" style=\"position:relative;\"><a href=\"#2-databasepy\" aria-label=\"2 databasepy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. database.py</h3>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\r\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>ext<span class=\"token punctuation\">.</span>declarative <span class=\"token keyword\">import</span> declarative_base\r\n<span class=\"token keyword\">from</span> sqlalchemy<span class=\"token punctuation\">.</span>orm <span class=\"token keyword\">import</span> sessionmaker\r\n\r\n<span class=\"token keyword\">from</span> api<span class=\"token punctuation\">.</span>settings <span class=\"token keyword\">import</span> get_settings<span class=\"token punctuation\">,</span> get_settings2\r\n\r\nBase_1 <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\nBase_2 <span class=\"token operator\">=</span> declarative_base<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\nSQLALCHEMY_DATABASE_URL <span class=\"token operator\">=</span> get_settings<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>db_dsn\r\nSQLALCHEMY_DATABASE_URL2 <span class=\"token operator\">=</span> get_settings2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>db_dsn\r\n\r\n<span class=\"token comment\">###multiple databases-1</span>\r\nengine1 <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>SQLALCHEMY_DATABASE_URL<span class=\"token punctuation\">)</span>\r\nSessionLocal1 <span class=\"token operator\">=</span> sessionmaker<span class=\"token punctuation\">(</span>autocommit<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> autoflush<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> bind<span class=\"token operator\">=</span>engine1<span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token comment\">###multiple databases-2</span>\r\nengine2 <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>SQLALCHEMY_DATABASE_URL2<span class=\"token punctuation\">)</span>\r\nSessionLocal2 <span class=\"token operator\">=</span> sessionmaker<span class=\"token punctuation\">(</span>autocommit<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> autoflush<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> bind<span class=\"token operator\">=</span>engine2<span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_db</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    session <span class=\"token operator\">=</span> SessionLocal1<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">yield</span> session\r\n        session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\r\n        session<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n        \r\n<span class=\"token keyword\">def</span> <span class=\"token function\">get_db2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    session <span class=\"token operator\">=</span> SessionLocal2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">yield</span> session\r\n        session<span class=\"token punctuation\">.</span>commit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span>\r\n        session<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>📌 sqlalchemy : SQL 문법 없이 개발 중인 언어로 데이터베이스에 접근할 수 있게 해주는 라이브러리를 <strong>ORM(Object Relational Mapping)</strong> 이라고 합니다. 그 중에서도 <a href=\"https://www.sqlalchemy.org/\"><strong>sqlalchemy</strong></a>은 python의 대표적인 ORM입니다.</li>\n</ul>\n<h3 id=\"3-modelpy\" style=\"position:relative;\"><a href=\"#3-modelpy\" aria-label=\"3 modelpy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. model.py</h3>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">from</span> api<span class=\"token punctuation\">.</span>database <span class=\"token keyword\">import</span> Base_1<span class=\"token punctuation\">,</span> Base_2 \r\n<span class=\"token keyword\">from</span> api<span class=\"token punctuation\">.</span>models<span class=\"token punctuation\">.</span>base_model <span class=\"token keyword\">import</span> ModelBase\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DB_Schema1</span><span class=\"token punctuation\">(</span>Base_1<span class=\"token punctuation\">,</span> ModelBase<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">\"DB_Schema1_table\"</span>\r\n\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DB_Schema2</span><span class=\"token punctuation\">(</span>Base_2<span class=\"token punctuation\">,</span> ModelBase<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    __tablename__ <span class=\"token operator\">=</span> <span class=\"token string\">\"DB_Schema2_table\"</span> </code></pre></div>\n<h3 id=\"4-routepy\" style=\"position:relative;\"><a href=\"#4-routepy\" aria-label=\"4 routepy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. route.py</h3>\n<div class=\"gatsby-highlight\" data-language=\"py\"><pre class=\"language-py\"><code class=\"language-py\"><span class=\"token keyword\">from</span> fastapi <span class=\"token keyword\">import</span> APIRouter<span class=\"token punctuation\">,</span> Depends<span class=\"token punctuation\">,</span> Body\r\n<span class=\"token keyword\">from</span> api<span class=\"token punctuation\">.</span>database <span class=\"token keyword\">import</span> get_db<span class=\"token punctuation\">,</span> get_db2\r\n\r\nrouter <span class=\"token operator\">=</span> APIRouter<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n\r\n<span class=\"token decorator annotation punctuation\">@router<span class=\"token punctuation\">.</span>get</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">\"/items/get_db1\"</span><span class=\"token punctuation\">,</span> description<span class=\"token operator\">=</span><span class=\"token string\">\"multiple DB\"</span>\r\n<span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">get_db1</span><span class=\"token punctuation\">(</span>\r\n    db<span class=\"token operator\">=</span>Depends<span class=\"token punctuation\">(</span>get_db<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    \r\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\r\n    \r\n    \r\n<span class=\"token decorator annotation punctuation\">@router<span class=\"token punctuation\">.</span>get</span><span class=\"token punctuation\">(</span>\r\n    <span class=\"token string\">\"/items/get_db2\"</span><span class=\"token punctuation\">,</span> description<span class=\"token operator\">=</span><span class=\"token string\">\"multiple DB\"</span>\r\n<span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">get_db2</span><span class=\"token punctuation\">(</span>\r\n    db<span class=\"token operator\">=</span>Depends<span class=\"token punctuation\">(</span>get_db2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    \r\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span></code></pre></div>\n<p><strong>[참고자료]</strong></p>\n<ul>\n<li><a href=\"https://blog.neonkid.xyz/253\">https://blog.neonkid.xyz/253</a></li>\n<li><a href=\"https://pydantic-docs.helpmanual.io/usage/settings/\">pydantic - BaseSettings</a></li>\n<li><a href=\"https://fastapi.tiangolo.com/advanced/settings/\">FastAPI - pydantic BaseSettings예제</a></li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#-intro\">💡 Intro</a></p>\n</li>\n<li>\n<p><a href=\"#-%EA%B7%B8%EC%A0%84%EC%97%90-fastapi%EB%9E%80\">🔎 그전에! FastAPI란?</a></p>\n</li>\n<li>\n<p><a href=\"#-multiple-databases-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\">📚 Multiple databases 설정하기</a></p>\n<ul>\n<li><a href=\"#1-settingspy\">1. settings.py</a></li>\n<li><a href=\"#2-databasepy\">2. database.py</a></li>\n<li><a href=\"#3-modelpy\">3. model.py</a></li>\n<li><a href=\"#4-routepy\">4. route.py</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"March 30, 2022","title":"FastAPI에 2개 이상의 DB연동하기","categories":"AWS 파이썬 FastAPI","author":"Liam","emoji":"💽"},"fields":{"slug":"/FastAPI-Multipledatabases/"}},"site":{"siteMetadata":{"siteUrl":"https://liampoet.github.io","comments":{"utterances":{"repo":"liampoet/liampoet.github.io"}}}}},"pageContext":{"slug":"/Lambda-Bootpay/","nextSlug":"/Lambda-CloudWatch2/","prevSlug":"/FastAPI-Multipledatabases/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}